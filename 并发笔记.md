### long在32位系统不是原子性

对于32位操作系统来说，单次次操作能处理的最长长度为32bit，而long类型8字节64bit，所以对long的读写都要两条指令才能完成（即每次读写64bit中的32bit）。

### cpu流水线指令

* 取指IF
* 译码和取寄存器操作数ID
* 执行或者有效地址计算EX
* 存储器访问MEM
* 写回WB

### java Thread类的线程状态定义

```java
public static enum State {
    NEW,
    RUNNABLE,
    BLOCKED,
    WAITING,
    TIMED_WAITING,
    TERMINATED;

    private State() {
    }
}
```



# ReentrantLock

ReentrantLock 可重入锁(能够连续获得同一把锁)

## 公平锁与非公平锁

公平锁能够解决饥饿现象(按队列里边的先后顺序)，需要维护一个有序队列，成本高性能相对较低。

非公平锁随机指定(synchronized就是非公平锁)。

```java
//默认使用非公平锁
public ReentrantLock() {
    this.sync = new ReentrantLock.NonfairSync();
}

public ReentrantLock(boolean fair) {
    this.sync = (ReentrantLock.Sync)(fair ? new ReentrantLock.FairSync() : new ReentrantLock.NonfairSync());
}
```

## 解决死锁的方法

* **中断响应：**通过使用lockInterruptibly()加锁，使得能够响应中断
* **锁申请等待限时：**使用tryLock(number, TimeUnit.SECONDS)传入等待时间，超时返回false



